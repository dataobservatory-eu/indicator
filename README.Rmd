---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# indicators

<!-- badges: start -->
[![R-CMD-check](https://github.com/dataobservatory-eu/indicator/workflows/R-CMD-check/badge.svg)](https://github.com/dataobservatory-eu/indicator/actions)
<!-- badges: end -->

The goal of indicators is to ...

## Installation

You can install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("dataobservatory-eu/indicator")
```
## Create a mini database

This code will create a  mini database from select Eurostat indicators:

```{r create-database}
library(indicators)
require(DBI)
require(dplyr)
# Make sure that it will work in a vignette, too:
data_raw_dir <- ifelse (dir.exists('data-raw'), 'data-raw', file.path('..', 'data-raw'))

create_eurostat_database (
  ids = c("ISOC_R_BLT12_I", "isoc_cicce_use", "teicp090", "tin00028"),
  db_path = file.path(data_raw_dir, "test_db.db")
)
```
```{r get-table-names}
disc_con <- dbConnect(RSQLite::SQLite(), file.path(data_raw_dir, "test_db.db") )

message  ("The following tables are present in the database: ")
DBI::dbListTables(disc_con)
```

```{r get-metadata-table }
db_metadata <- DBI::dbReadTable(disc_con, "metadata")

internet_use_indicators <- db_metadata %>% 
  select ( all_of(c("indicator_code", "description_indicator", "actual", "missing"))) %>%
  filter ( grepl("internet use", tolower(.data$description_indicator)) ) %>%
  relocate ( .data$indicator_code, .after = .data$missing )

```

And now select the indicators:

```{r get-select-indicators}
test_indicators <- DBI::dbGetQuery(
  conn = disc_con, 
  "SELECT indicator_code, value, geo, time, estimate FROM indicator 
   WHERE indicator_code = ?", 
  params = list(internet_use_indicators$indicator_code)
)

head(test_indicators,12)
```
Another simple query:

```{r get-count}
DBI::dbGetQuery(conn = disc_con, 
                "SELECT COUNT(*) FROM indicator 
                WHERE indicator_code = ?", 
                params = list(internet_use_indicators$indicator_code)
                )

```
```{r disconnect}
DBI::dbDisconnect(disc_con)
```

See the vignettes:

```{r see-vignettes}
vignette( package="indicators")
```


Please note that the indicators project is released with a [Contributor Code of Conduct](https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html). By contributing to this project, you agree to abide by its terms.

You'll still need to render `README.Rmd` regularly, to keep `README.md` up-to-date. `devtools::build_readme()` is handy for this. You could also use GitHub Actions to re-render `README.Rmd` every time you push. An example workflow can be found here: <https://github.com/r-lib/actions/tree/master/examples>.



